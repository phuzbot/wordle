<!DOCTYPE html>
<html>
  <head>
    <style>
      .positionMatch {
        color: green;
      }
      .presenceMatch {
        color: orange;
      }
      .noMatch {
        color: black;
      }
      .noGuess {
        color: darkgray;
      }
    </style>
  </head>
  <body>
    <div
      id="guessContainer"
      style="
        font-family: 'Lucida Console', monospace;
        text-transform: uppercase;
      "
    ></div>

    <input id="guessInput" type="text" name="txt" value="" />
    <div
      id="keyboardContainer"
      style="
        font-family: 'Lucida Console', monospace;
        text-transform: uppercase;
      "
    ></div>
    <div id="errorMessage"></div>

    <button type="button" onclick="submitGuess()">Submit Guess</button>

    <script>
      const wordLength = 5;

      const word = "hello";
      const keyboard = ["qwertyuiop", "asdfghjkl", "zxcvbnm"];

      let positionMatchLetters = "";
      let presenceMatchLetters = "";
      let noMatchLetters = "";

      const guesses = [];

      let allWords = [];

      function myFunction() {
        document.getElementById("demo").innerHTML = "Hello JavaScript!";
      }

      function httpGetAsync(theUrl, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
        };
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
      }

      /**
       * @param {string} answer
       * @param {string} guess
       */
      function getMatches(answer, guess) {
        const result = [];
        let nonPositionMatched = "";
        for (let i = 0; i < wordLength; i++) {
          result.push("noMatch");
        }
        for (let i = 0; i < wordLength; i++) {
          noMatchLetters += guess[i];
          if (answer[i] == guess[i]) {
            result[i] = "positionMatch";
            positionMatchLetters += answer[i];
          } else {
            nonPositionMatched += answer[i];
          }
        }
        for (let i = 0; i < wordLength; i++) {
          if (answer[i] == guess[i]) {
            // exact match ignore
          } else if (nonPositionMatched.includes(guess[i])) {
            nonPositionMatched = nonPositionMatched.replace(guess[i], "");
            result[i] = "presenceMatch";
            presenceMatchLetters += guess[i];
          }
        }
        return result;
      }

      function showGuesses() {
        const guessContainer = document.getElementById("guessContainer");
        guessContainer.innerHTML = "";
        positionMatchLetters = "";
        presenceMatchLetters = "";
        noMatchLetters = "";
        for (let i = 0; i < guesses.length; i++) {
          const guess = guesses[i];
          const matches = getMatches(word, guess);
          const wordElement = document.createElement("p");
          guessContainer.appendChild(wordElement);
          for (let j = 0; j < wordLength; j++) {
            const characterElement = document.createElement("span");
            characterElement.innerHTML = guess[j];
            characterElement.classList.add(matches[j]);
            wordElement.appendChild(characterElement);
          }
        }
        const keyboardContainer = document.getElementById("keyboardContainer");
        keyboardContainer.innerHTML = "";
        for (let rowIndex = 0; rowIndex < keyboard.length; rowIndex++) {
          let keyboardRow = keyboard[rowIndex];
          const keyboardRowElement = document.createElement("p");
          keyboardContainer.appendChild(keyboardRowElement);
          for (
            let characterIndex = 0;
            characterIndex < keyboardRow.length;
            characterIndex++
          ) {
            const keyElement = document.createElement("span");
            const characterValue = keyboardRow[characterIndex];
            keyElement.innerHTML = characterValue;
            if (positionMatchLetters.includes(characterValue)) {
              keyElement.classList.add("positionMatch");
            } else if (presenceMatchLetters.includes(characterValue)) {
              keyElement.classList.add("presenceMatch");
            } else if (noMatchLetters.includes(characterValue)) {
              keyElement.classList.add("noMatch");
            } else {
              keyElement.classList.add("noGuess");
            }
            keyboardRowElement.appendChild(keyElement);
          }
        }
      }

      /**
       * @param {string} newGuess
       */
      function submitGuess() {
        const newGuess = document
          .getElementById("guessInput")
          .value.toLowerCase();
        document.getElementById("guessInput").value = "";
        if (!allWords.includes(newGuess)) {
          const errorMessage = document.getElementById("errorMessage");
          errorMessage.innerHTML = newGuess + " is not a word";
          return;
        }
        guesses.push(newGuess);
        showGuesses();
      }

      async function main() {
        httpGetAsync("/words", (/** @type {string} */ v) => {
          allWords = v.split("\n");
        });
      }
      main();
    </script>
  </body>
</html>
