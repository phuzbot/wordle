<!DOCTYPE html>
<html>
  <head>
    <style>
      .positionMatch {
        color: green;
      }
      .presenceMatch {
        color: orange;
      }
      .noMatch {
        color: black;
      }
    </style>
  </head>
  <body>
    <div
      id="guessContainer"
      style="
        font-family: 'Lucida Console', monospace;
        text-transform: uppercase;
      "
    ></div>

    <input id="guessInput" type="text" name="txt" value="" />
    <div id="errorMessage"></div>

    <button type="button" onclick="submitGuess()">Submit Guess</button>

    <script>
      const wordLength = 5;

      const word = "hello";
      const letters1 = "qwertyuiop";
      const letters2 = "asdfghjkl";
      const letters3 = "zxcvbnm";

      const guesses = [];

      let allWords = [];

      function myFunction() {
        document.getElementById("demo").innerHTML = "Hello JavaScript!";
      }

      function httpGetAsync(theUrl, callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
        };
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
      }

      /**
       * @param {string} answer
       * @param {string} guess
       */
      function getMatches(answer, guess) {
        const result = [];
        let nonPositionMatched = "";
        for (let i = 0; i < wordLength; i++) {
          result.push("noMatch");
        }
        for (let i = 0; i < wordLength; i++) {
          if (answer[i] == guess[i]) {
            result[i] = "positionMatch";
          } else {
            nonPositionMatched += answer[i];
          }
        }
        for (let i = 0; i < wordLength; i++) {
          if (answer[i] == guess[i]) {
            // exact match ignore
          } else {
            if (nonPositionMatched.includes(guess[i])) {
              nonPositionMatched = nonPositionMatched.replace(guess[i], "");
              result[i] = "presenceMatch";
            }
          }
        }
        return result;
      }

      function showGuesses() {
        const guessContainer = document.getElementById("guessContainer");
        guessContainer.innerHTML = "";
        for (let i = 0; i < guesses.length; i++) {
          const guess = guesses[i];
          const matches = getMatches(word, guess);
          const wordElement = document.createElement("p");
          guessContainer.appendChild(wordElement);
          for (let j = 0; j < wordLength; j++) {
            const characterElement = document.createElement("span");
            characterElement.innerHTML = guess[j];
            characterElement.classList.add(matches[j]);
            wordElement.appendChild(characterElement);
          }
        }
      }

      /**
       * @param {string} newGuess
       */
      function submitGuess() {
        const newGuess = document
          .getElementById("guessInput")
          .value.toLowerCase();
        document.getElementById("guessInput").value = "";
        if (!allWords.includes(newGuess)) {
          const errorMessage = document.getElementById("errorMessage");
          errorMessage.innerHTML = newGuess + " is not a word";
          return;
        }
        guesses.push(newGuess);
        showGuesses();
      }

      async function main() {
        httpGetAsync("/words", (/** @type {string} */ v) => {
          allWords = v.split("\n");
        });
      }
      main();
    </script>
  </body>
</html>
